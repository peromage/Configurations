# Author: Fang
# Date: 2020/04/11

function loadmodule {
    # $1: Folder where the module resides
    # $2: Module names. Separated by ','
    # $3: The default module extension
    # Note: Module name supports glob
    
    # Check if give module directory exists
    [ ! -d "$1" ] && return
    # Change current working directory
    local modules i md ext savedcwd
    savedcwd=$(pwd)
    cd $1
    # Expand glob in current module directory
    modules=(${2//,/ })
    # Module extension
    if [ -z "$3" ]; then
        ext=".shm"
    else
        ext=$3
    fi
    # Iterate through module list
    for i in ${modules[@]}; do
        # Strip suffix and append with expected module suffix
        md="${i%.*}$ext"
        # If module with suffix exists, source it.
        [ -f "$md" ] && . "$md"
    done
    # Restore working directory
    cd "$savedcwd"
}
